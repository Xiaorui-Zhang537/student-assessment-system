<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.noncore.assessment.mapper.AnalyticsCacheMapper">

    <resultMap id="AnalyticsCacheResultMap" type="com.noncore.assessment.entity.AnalyticsCache">
        <id column="cache_key" property="cacheKey"/>
        <result column="cache_value" property="cacheValue"/>
        <result column="generated_at" property="generatedAt"/>
    </resultMap>

    <select id="findByKey" resultMap="AnalyticsCacheResultMap">
        SELECT * FROM analytics_cache WHERE cache_key = #{cacheKey}
    </select>

    <insert id="upsert" parameterType="com.noncore.assessment.entity.AnalyticsCache">
        INSERT INTO analytics_cache (cache_key, cache_value, generated_at)
        VALUES (#{cacheKey}, #{cacheValue}, #{generatedAt})
        ON DUPLICATE KEY UPDATE
        cache_value = VALUES(cache_value),
        generated_at = VALUES(generated_at)
    </insert>

</mapper> 